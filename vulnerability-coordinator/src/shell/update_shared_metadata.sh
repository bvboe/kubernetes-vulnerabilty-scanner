#!/bin/bash
SCAN_DIRECTORY=$1
OUTPUT_DIRECTORY=$2
echo "./process_sbom.sh $SCAN_DIRECTORY $OUTPUT_DIRECTORY"
echo Scan directory: $SCAN_DIRECTORY
echo Output directory: $OUTPUT_DIRECTORY



jq -s '
  reduce .[] as $item (
    {
      "unique-packages": [],
      "severities": [],
      "fix-states": []
    };
    {
      "unique-packages": (.["unique-packages"] + $item["unique-packages"] | unique | sort),
      "severities": (.["severities"] + $item["severities"] | unique | sort),
      "fix-states": (.["fix-states"] + $item["fix-states"] | unique | sort)
    }
  )
' $SCAN_DIRECTORY/*/metadata.json > $OUTPUT_DIRECTORY/metadata.json